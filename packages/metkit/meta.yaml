package:
  name: metkit
  version: 1.13.0

source:
  url: https://github.com/ecmwf/metkit/archive/refs/tags/1.13.0.tar.gz
  sha256: e62c528c5436452cdb9620bbbd36845291158d755817d61601ca2b8e0a53367f

requirements:
  host:
    - eckit

build:
  type: shared_library
  script: |
    git clone --branch 3.7.2 --depth 1 https://github.com/ecmwf/ecbuild;

    mkdir -p build;

    cd build \
        && emcmake cmake ../ \
        -DCMAKE_INSTALL_PREFIX=${WASM_LIBRARY_DIR} \
        -DBUILD_SHARED_LIBS=ON \
        -DDISABLE_OS_CHECK=ON \
        -DENABLE_BUILD_TOOLS=OFF \
        -DENABLE_EXPERIMENTAL=OFF \
        -DENABLE_GRIB=ON \
        -DENABLE_BUFR=ON \
        -DENABLE_NETCDF=OFF \
        -DENABLE_ODB=OFF \
        -DENABLE_TESTS=OFF;

    emmake make -j ${PYODIDE_JOBS:-3};
    emmake make -j ${PYODIDE_JOBS:-3} install;
